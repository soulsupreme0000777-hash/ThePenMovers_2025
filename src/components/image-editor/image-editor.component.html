<div class="bg-gray-900 p-6 rounded-lg shadow-xl max-w-5xl mx-auto">
  <div class="flex flex-col gap-4">
    <h2 class="text-2xl font-bold text-center text-green-500 font-['Orbitron']">Generative Image Editor</h2>
    <p class="text-center text-gray-400">Transform your photos with simple text commands. Upload an image, describe your desired edit—like changing colors, adding elements, or applying a style—and watch the AI rework it. This is an experimental feature for creative exploration.</p>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="flex flex-col gap-2">
        <label for="image-upload" class="cursor-pointer bg-gray-800 border-2 border-dashed border-gray-600 rounded-lg p-4 text-center hover:border-green-500 transition-colors">
          <span class="text-gray-400">{{ selectedFile() ? selectedFile().name : 'Click to upload an image' }}</span>
          <input id="image-upload" type="file" class="hidden" accept="image/*" (change)="onFileSelected($event)" />
        </label>
        <textarea
          class="w-full p-3 bg-gray-800 border border-gray-700 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition text-gray-200"
          rows="3"
          placeholder="e.g., Add a futuristic city in the background"
          [value]="prompt()"
          (input)="prompt.set($event.target.value)"
          [disabled]="!selectedFile()">
        </textarea>
      </div>
      <button 
        (click)="editImage()" 
        [disabled]="loading() || !prompt().trim() || !selectedFile()"
        class="w-full md:w-auto self-center md:self-end p-3 bg-green-600 text-white font-bold rounded-md hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors duration-200">
        Generate Edit
      </button>
    </div>

    @if (error()) {
      <p class="text-red-500 text-center mt-2">{{ error() }}</p>
    }

    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="bg-black p-4 rounded-lg flex flex-col items-center justify-center min-h-[300px]">
        <h3 class="font-semibold mb-2 text-gray-400">Original</h3>
        @if(originalImageUrl(); as url) {
          <img [src]="url" alt="Original" class="rounded-md max-w-full max-h-[400px] object-contain">
        } @else {
          <p class="text-gray-500">Upload an image to start</p>
        }
      </div>
      <div class="bg-black p-4 rounded-lg flex flex-col items-center justify-center min-h-[300px]">
        <h3 class="font-semibold mb-2 text-gray-400">Edited</h3>
        @if (loading()) {
          <app-loader [text]="loadingMessage()" />
        } @else if(editedImageUrl(); as url) {
          <div class="relative group">
            <img [src]="url" alt="Edited" class="rounded-md max-w-full max-h-[400px] object-contain">
            <div class="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-md">
              <button (click)="showDownloadModal.set(true)" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md hover:bg-green-700 transition-colors flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                Download
              </button>
            </div>
          </div>
        } @else {
          <p class="text-gray-500">Your edited image will appear here.</p>
        }
      </div>
    </div>
  </div>
</div>

@if(showDownloadModal() && editedImageUrl()) {
  <app-download-modal 
    [imageUrl]="editedImageUrl()!" 
    (close)="showDownloadModal.set(false)" />
}